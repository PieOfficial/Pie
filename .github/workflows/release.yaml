name: Release

on:
  push:
    tags:
      - 'v*'


jobs: 
   build:
    strategy:
      matrix:
        os: [windows-latest]
        build_type: [Release]
        c_compiler: [gcc, clang, cl]
        include:
          - os: windows-latest
            c_compiler: gcc
            cpp_compiler: g++
        exclude:
          - os: windows-latest
            c_compiler: clang
    name: Release
    runs-on: windows-latest
    permissions: write-all
    steps:
     - uses: actions/checkout@v3
       with:
        version: "^1.0.0"
        token: ${{ SECRETS.GITHUB_TOKEN }}
     - name: cmake
       run: cmake -G "MinGW Makefiles" -B "./build" -DCMAKE_CXX_COMPILER=${{ matrix.cpp_compiler }} -DCMAKE_C_COMPILER=${{ matrix.c_compiler }} -DCMAKE_BUILD_TYPE=${{ matrix.build_type }}
     - name: make
       run: |
        cd ./build
        make
     - name: Get version
       id: get_version
       run: echo ::set-output name=VERSION::${GITHUB_REF#refs/tags/}
     - name: ziping
       run: powershell Compress-Archive ./build ./output.zip
     - name: Release
       uses: softprops/action-gh-release@v1
       with:
          name: Release ${{ steps.get_version.outputs.VERSION }}
          fail_on_unmatched_files: true
          files: |
            output.zip
